<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/css/bootstrap.min.css" integrity="sha384-MIwDKRSSImVFAZCVLtU0LMDdON6KVCrZHyVQQj6e8wIEJkW4tvwqXrbMIya1vriY" crossorigin="anonymous">

        <title>Test</title>
    </head>
    <body>
        <h1></h1>
        <form>
            <div class="form-group">
                <input type="text" class="form-control host-name" placeholder="Domain name">
                <button type="submit" class="btn btn-default">Submit</button>
            </div>
        </form>
        <table class="table">

            <thead>
                <tr>
                    <th>Type
                    <th>TTL
                    <th>Priority
                    <th>Data
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr><td>No data
            </tfoot>
        </table>
        <script src="https://matreshkajs.github.io/bundle/matreshka.min.js"></script>
        <script>
            window.app = new class Table extends Matreshka.Array {
                itemRenderer() {
                    return `<tr>
                        <th>{{typeStr}}</th>
                        <td>{{ttl}}</td>
                        <td>{{priority}}</td>
                        <td>{{dataStr}}</td>
                    </tr>`
                }

                constructor() {
                    super()
                        .bindNode('sandbox', 'body')
                        .bindNode('hostName', ':sandbox .host-name')
                        .bindNode('container', ':sandbox tbody')
                        .bindNode('length', ':sandbox tfoot', Matreshka.binders.display(false))
                        .on('submit::(form)', evt => {
                            evt.preventDefault();
                            this.lookup();
                        })
                }

                lookup() {
                    fetch('api/lookup/', {
                        method: 'post',
                        body: JSON.stringify({
                            hostName: this.hostName
                        }),
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(resp => resp.json())
                    .then(({ error, data }) => {
                        if(error) {
                            alert(error);
                        } else {
                            console.log(data);
                            this.recreate(this.patch(data));
                        }
                    })
                    .catch(error => { throw error });
                }

                patch(data) {
                    const newData = [];

                    const types = {
                        1: { type: 'A', getData: item => item.address },
                        2: { type: 'NS', getData: item => item.data },
                        5: { type: 'CNAME', getData: item => item.data },
                        6: { type: 'SOA', getData: item => item.primary + ' ' + item.admin + ' ' + item.serial + ' ' + item.refresh + ' ' + item.retry + ' ' + item.expiration + ' ' + item.minimum },
                        12: { type: 'PTR', getData: item => item.data },
                        15: { type: 'MX',  getData: item => item.exchange + ' ' + item.priority },
                        16: { type: 'TXT', getData: item => item.data },
                        28: { type: 'AAAA', getData: item => item.address },
                        33: { type: 'SRV', getData: item => item.weight + ' ' + item.port + ' ' + item.weight },
                        35: { type: 'NAPTR', getData: item => item.data }
                    }

                    for(const item of data) {
                        if(!types[item.type]) {
                            continue;
                        }
                        const type = types[item.type].type;
                        item.typeStr = type;
                        item.dataStr = types[item.type].getData(item);
                        newData.push(item)
                    }

                    return newData;
                }
            }
        </script>
    </body>
</html>
